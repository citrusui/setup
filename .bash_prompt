#!/usr/bin/env bash

if ls --color > /dev/null 2>&1; then
	colorflag="--color"
	export LS_COLORS="di=1;36:ln=1;32:so=37:pi=1;31;40:ex=35:bd=37:cd=37:su=37:sg=37:tw=32:ow=32"
else
	colorflag="-G"
	export LSCOLORS="GxCxhxBafxhxhxhxhxcxcx"
fi

alias ls="ls ${colorflag}"
alias sh="bash"
alias sudo="sudo "

if [[ $COLORTERM = gnome-* && $TERM = xterm ]] && infocmp gnome-256color >/dev/null 2>&1; then
	export TERM="gnome-256color";
elif infocmp xterm-256color >/dev/null 2>&1; then
	export TERM="xterm-256color";
fi;

prompt() {
	local s="";
	local branchName="";

	if [ $(git rev-parse --is-inside-work-tree &>/dev/null; echo "${?}") == "0" ]; then

		if [ "$(git rev-parse --is-inside-git-dir 2> /dev/null)" == "false" ]; then

			git update-index --really-refresh -q &>/dev/null;

			if ! $(git diff --quiet --ignore-submodules --cached); then
				s+="+";
			fi;

			if ! $(git diff-files --quiet --ignore-submodules --); then
				s+="!";
			fi;

			if [ -n "$(git ls-files --others --exclude-standard)" ]; then
				s+="?";
			fi;

			if $(git rev-parse --verify refs/stash &>/dev/null); then
				s+="$";
			fi;

		fi;

		branchName="$(git symbolic-ref --quiet --short HEAD 2> /dev/null || \
			git rev-parse --short HEAD 2> /dev/null || \
			echo "(unknown)")";

		[ -n "${s}" ] && s=" [${s}]";

		echo "${1}${branchName}${2}${s}";
	else
		return;
	fi;
}

tput sgr0;
reset=$(tput sgr0);

if [ "$(echo $TERM_PROGRAM)" == "Apple_Terminal" ]; then
	blue=$(tput setaf 4);
  green=$(tput setaf 2);
  orange=$(tput setaf 32);
  red=$(tput setaf 2);
  violet=$(tput setaf 26);
  white=$(tput setaf 7);
  yellow=$(tput setaf 220);
else
  blue="\e[38;2;68;146;191m"; #4ea5d9
  green="\e[38;2;121;206;128m"; #79ce80
  orange="\e[38;2;255;87;45m"; #ff572d
  red="\e[38;2;224;52;49m"; #e03431
  violet="\e[38;2;87;98;213m"; #5762d5
  white="\e[38;2;249;249;249m"; #f9f9f9
  yellow="\e[38;2;232;227;102m"; #e8e366
fi

if [[ "${USER}" == "root" ]]; then
	userStyle="${red}";
else
	userStyle="${violet}";
fi;

if [[ "${SSH_TTY}" ]]; then
	hostStyle="${yellow}";
fi;

PS1="\[\033[1;37m\]";
PS1+="\n";
PS1+="\[${userStyle}\]\u ";
PS1+="\[${green}\]\w";
PS1+="\$(prompt \" \[${blue}\]\" \"\[${orange}\]\")";
PS1+="\[${white}\]\n";

if [[ "${USER}" == "root" ]]; then
	PS1+="# \[${reset}\]";
else
	PS1+="$ \[${reset}\]";
fi;
